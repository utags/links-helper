;(() => {
  const expectedList = [
    '<h2><a href="./test.html">内部链接</a></h2> <p>不应该新窗口打开</p>',
    '<h2><a href="https://dto.pipecraft.net/" target="_blank" rel="noopener">DTO 社区</a></h2> <p>一个类似 Hacker News, Lobsters 的链接分享社区</p>',
    '<h2> <a href="https://discuss-cn.bestxtools.com/" target="_blank" rel="noopener">BestXTools 社区</a> </h2> <p> 一个发现并分享有趣，有创意，免费、好用的工具的非商业性质的，独立的，开放的社区 </p>',
    '<h2>测试文本转链接</h2> <p><span><a href="https://v2hot.pipecraft.net" target="_blank" rel="noopener">https://v2hot.pipecraft.net</a></span></p>',
    '<h2>测试文本转链接</h2> <p><span><a href="https://v2hot.pipecraft.net/" target="_blank" rel="noopener">https://v2hot.pipecraft.net/</a></span></p>',
    '<h2>测试文本转链接</h2> <p><span><a href="https://v2hot.pipecraft.net/?a=123" target="_blank" rel="noopener">https://v2hot.pipecraft.net/?a=123</a></span></p>',
    '<h2>测试文本转链接</h2> <p><span><a href="https://v2hot.pipecraft.net/?a=123&amp;b=1234" target="_blank" rel="noopener">https://v2hot.pipecraft.net/?a=123&amp;b=1234</a></span></p>',
    '<h2>测试文本转链接</h2> <p><span><a href="https://v2hot.pipecraft.net/#a=123" target="_blank" rel="noopener">https://v2hot.pipecraft.net/#a=123</a></span></p>',
    '<h2>测试文本转链接</h2> <p><span><a href="https://v2hot.pipecraft.net/?a=123#b=1234" target="_blank" rel="noopener">https://v2hot.pipecraft.net/?a=123#b=1234</a></span></p>',
    '<h2>测试文本转链接</h2> <p><span>测试（<a href="https://v2hot.pipecraft.net/" target="_blank" rel="noopener">https://v2hot.pipecraft.net/</a>）</span></p>',
    '<h2>测试文本转链接</h2> <p><span>测试（<a href="https://v2hot.pipecraft.net/hot/newest/" target="_blank" rel="noopener">https://v2hot.pipecraft.net/hot/newest/</a>）</span></p>',
    '<h2>测试多个文本转链接</h2> <p><span> 测试（<a href="https://v2hot.pipecraft.net/hot/newest/" target="_blank" rel="noopener">https://v2hot.pipecraft.net/hot/newest/</a>）测试（<a href="https://v2hot.pipecraft.net/hot/hottest-3/" target="_blank" rel="noopener">https://v2hot.pipecraft.net/hot/hottest-3/</a>） </span></p>',
    '<h2>测试多个特殊域名链接</h2> <p><span> 测试<a href="https://example.academy" target="_blank" rel="noopener">https://example.academy</a> <a href="https://example.academy/abcd" target="_blank" rel="noopener">https://example.academy/abcd</a></span><br><span> 测试<a href="http://localhost" target="_blank" rel="noopener">http://localhost</a> <a href="http://localhost/abcd" target="_blank" rel="noopener">http://localhost/abcd</a></span><br><span> 测试<a href="https://123.123.123.123" target="_blank" rel="noopener">https://123.123.123.123</a> / <a href="https://123.123.123.123/1234" target="_blank" rel="noopener">https://123.123.123.123/1234</a> / <a href="https://123.123.123.123:8080" target="_blank" rel="noopener">https://123.123.123.123:8080</a> / <a href="https://123.123.123.123:8080/abcd" target="_blank" rel="noopener">https://123.123.123.123:8080/abcd</a></span><br> </p>',
    '<h2> 测试多个文本转链接，链接转图片，当图片链接出问题时，转换到原来的内容 </h2> <p><span>测试<a href="https://assets.bestxtools.com/s2/main/images/404.png" target="_blank" rel="noopener noreferrer">https://assets.bestxtools.com/s2/main/images/404.png<i class="lh_img_load_failed"> (failed to load)</i></a>测试</span></p>',
    '<h2>测试多个文本转链接，链接转图片</h2> <p><span> 测试<a href="https://assets.bestxtools.com/s2/main/images/2023-03-14-16-20-03.png" target="_blank" rel="noopener noreferrer"><img src="https://assets.bestxtools.com/s2/main/images/2023-03-14-16-20-03.png" title="https://assets.bestxtools.com/s2/main/images/2023-03-14-16-20-03.png" alt="https://assets.bestxtools.com/s2/main/images/2023-03-14-16-20-03.png" role="img" style="max-width: 100% !important; vertical-align: bottom;" loading="lazy" referrerpolicy="no-referrer"></a>测试 测试<a href="https://img.tcoding.cn/cnHfru.png" target="_blank" rel="noopener noreferrer"><img src="https://img.tcoding.cn/cnHfru.png" title="https://img.tcoding.cn/cnHfru.png" alt="https://img.tcoding.cn/cnHfru.png" role="img" style="max-width: 100% !important; vertical-align: bottom;" loading="lazy" referrerpolicy="no-referrer"></a>测试 测试<a href="https://s3.bmp.ovh/imgs/2023/03/29/2c51632c2b11b77c.gif" target="_blank" rel="noopener noreferrer"><img src="https://s3.bmp.ovh/imgs/2023/03/29/2c51632c2b11b77c.gif" title="https://s3.bmp.ovh/imgs/2023/03/29/2c51632c2b11b77c.gif" alt="https://s3.bmp.ovh/imgs/2023/03/29/2c51632c2b11b77c.gif" role="img" style="max-width: 100% !important; vertical-align: bottom;" loading="lazy" referrerpolicy="no-referrer"></a>测试 测试<a href="https://i.imgur.com/gi2b1rj.jpeg" target="_blank" rel="noopener noreferrer"><img src="https://i.imgur.com/gi2b1rj.jpeg" title="https://i.imgur.com/gi2b1rj.jpeg" alt="https://i.imgur.com/gi2b1rj.jpeg" role="img" style="max-width: 100% !important; vertical-align: bottom;" loading="lazy" referrerpolicy="no-referrer"></a>测试 测试<a href="https://s2.loli.net/2023/04/25/n4tdNgr578pKByk.jpg" target="_blank" rel="noopener noreferrer"><img src="https://s2.loli.net/2023/04/25/n4tdNgr578pKByk.jpg" title="https://s2.loli.net/2023/04/25/n4tdNgr578pKByk.jpg" alt="https://s2.loli.net/2023/04/25/n4tdNgr578pKByk.jpg" role="img" style="max-width: 100% !important; vertical-align: bottom;" loading="lazy" referrerpolicy="no-referrer"></a>测试 测试新浪图片<a href="http://tva1.sinaimg.cn/large/8f78f96fly1hdncxvoursj20ys0oq41c.jpg" target="_blank" rel="noopener">http://tva1.sinaimg.cn/large/8f78f96fly1hdncxvoursj20ys0oq41c.jpg</a>测试 </span></p>',
    '<h2>测试图床详细页（预览）链接转图片链接</h2> <p><span> 测试<a href="https://imgur.com/gi2b1rj" target="_blank" rel="noopener noreferrer"><img src="https://i.imgur.com/gi2b1rj.png" title="https://imgur.com/gi2b1rj" alt="https://imgur.com/gi2b1rj" role="img" style="max-width: 100% !important; vertical-align: bottom;" loading="lazy" referrerpolicy="no-referrer"></a>测试 测试<a href="https://imgur.com/gi2b1rj.png" target="_blank" rel="noopener noreferrer"><img src="https://i.imgur.com/gi2b1rj.png" title="https://imgur.com/gi2b1rj.png" alt="https://imgur.com/gi2b1rj.png" role="img" style="max-width: 100% !important; vertical-align: bottom;" loading="lazy" referrerpolicy="no-referrer"></a>测试 测试<a href="https://i.imgur.com/SX8jMwY" target="_blank" rel="noopener noreferrer"><img src="https://i.imgur.com/SX8jMwY.png" title="https://i.imgur.com/SX8jMwY" alt="https://i.imgur.com/SX8jMwY" role="img" style="max-width: 100% !important; vertical-align: bottom;" loading="lazy" referrerpolicy="no-referrer"></a>测试 测试<a href="http://imgur.com/gi2b1rj" target="_blank" rel="noopener noreferrer"><img src="https://i.imgur.com/gi2b1rj.png" title="http://imgur.com/gi2b1rj" alt="http://imgur.com/gi2b1rj" role="img" style="max-width: 100% !important; vertical-align: bottom;" loading="lazy" referrerpolicy="no-referrer"></a>测试 测试<a href="http://i.imgur.com/SX8jMwY" target="_blank" rel="noopener noreferrer"><img src="https://i.imgur.com/SX8jMwY.png" title="http://i.imgur.com/SX8jMwY" alt="http://i.imgur.com/SX8jMwY" role="img" style="max-width: 100% !important; vertical-align: bottom;" loading="lazy" referrerpolicy="no-referrer"></a>测试 测试<a href="https://camo.githubusercontent.com/673211e46a77289d075c1c39d4aebfa4fa3032e911a21c4385302ddf2b2572fc/68747470733a2f2f677265617379666f726b2e73332e75732d656173742d322e616d617a6f6e6177732e636f6d2f7a6262626b73786875306e7466786272797a7038347333647a383862" target="_blank" rel="noopener noreferrer"><img src="https://camo.githubusercontent.com/673211e46a77289d075c1c39d4aebfa4fa3032e911a21c4385302ddf2b2572fc/68747470733a2f2f677265617379666f726b2e73332e75732d656173742d322e616d617a6f6e6177732e636f6d2f7a6262626b73786875306e7466786272797a7038347333647a383862" title="https://camo.githubusercontent.com/673211e46a77289d075c1c39d4aebfa4fa3032e911a21c4385302ddf2b2572fc/68747470733a2f2f677265617379666f726b2e73332e75732d656173742d322e616d617a6f6e6177732e636f6d2f7a6262626b73786875306e7466786272797a7038347333647a383862" alt="https://camo.githubusercontent.com/673211e46a77289d075c1c39d4aebfa4fa3032e911a21c4385302ddf2b2572fc/68747470733a2f2f677265617379666f726b2e73332e75732d656173742d322e616d617a6f6e6177732e636f6d2f7a6262626b73786875306e7466786272797a7038347333647a383862" role="img" style="max-width: 100% !important; vertical-align: bottom;" loading="lazy" referrerpolicy="no-referrer"></a>测试 测试<a href="https://imgur.io/R3fytUm" target="_blank" rel="noopener noreferrer"><img src="https://i.imgur.com/R3fytUm.png" title="https://imgur.io/R3fytUm" alt="https://imgur.io/R3fytUm" role="img" style="max-width: 100% !important; vertical-align: bottom;" loading="lazy" referrerpolicy="no-referrer"></a>测试 测试<a href="https://imgur.io/R3fytUm.jpg" target="_blank" rel="noopener noreferrer"><img src="https://i.imgur.com/R3fytUm.jpg" title="https://imgur.io/R3fytUm.jpg" alt="https://imgur.io/R3fytUm.jpg" role="img" style="max-width: 100% !important; vertical-align: bottom;" loading="lazy" referrerpolicy="no-referrer"></a>测试 </span></p>',
    '<h2>测试 markdown 格式文本转链接</h2> <p><span> 测试<a href="https://v2hot.pipecraft.net/hot/newest/" target="_blank" rel="noopener">测试</a>测试</span><br><span> 测试<a href="https://v2hot.pipecraft.net/hot/newest/" target="_blank" rel="noopener">测试</a>测试(v2ex 不会解析评论中的 markdown 格式，并在 </span><code>(</code>后面加一个空格)<br><span> 测试<img src="https://assets.bestxtools.com/s2/main/images/2023-03-14-16-20-03.png" title="myimg" alt="myimg" role="img" style="max-width: 100% !important; vertical-align: bottom;" loading="lazy" referrerpolicy="no-referrer">测试</span><br><span> 测试<img src="https://assets.bestxtools.com/s2/main/images/2023-03-14-16-20-03.png" title="image" alt="image" role="img" style="max-width: 100% !important; vertical-align: bottom;" loading="lazy" referrerpolicy="no-referrer">测试</span><br><span> 测试<img src="https://i.imgur.com/gi2b1rj.png" title="image" alt="image" role="img" style="max-width: 100% !important; vertical-align: bottom;" loading="lazy" referrerpolicy="no-referrer">测试</span><br> </p>',
    '<h2>测试 markdown 嵌套格式文本转链接</h2> <p><span> 测试<a href="https://imgloc.com/i/iQQfVZ" target="_blank" rel="noopener"><img src="https://i.328888.xyz/2023/05/10/iQQfVZ.png" title="iQQfVZ.png" alt="iQQfVZ.png" role="img" style="max-width: 100% !important; vertical-align: bottom;" loading="lazy" referrerpolicy="no-referrer"></a>测试</span><br><span> 测试<a href="https://imgloc.com/i/iQQfVZ" target="_blank" rel="noopener">abc<img src="https://i.328888.xyz/2023/05/10/iQQfVZ.png" title="iQQfVZ.png" alt="iQQfVZ.png" role="img" style="max-width: 100% !important; vertical-align: bottom;" loading="lazy" referrerpolicy="no-referrer">abc</a>测试</span><br><span> 测试[测<a href="https://v2hot.pipecraft.net/hot/newest/" target="_blank" rel="noopener">abc</a><span>试](<a href="https://v2hot.pipecraft.net/hot/newest/" target="_blank" rel="noopener">https://v2hot.pipecraft.net/hot/newest/</a>)测试(只应解析里面的 a 标签)</span></span><br><span> ![<a href="https://v2hot.pipecraft.net/hot/newest/" target="_blank" rel="noopener">iQQfVZ.png</a><span>]( <a href="https://i.328888.xyz/2023/05/10/iQQfVZ.png" target="_blank" rel="noopener noreferrer"><img src="https://i.328888.xyz/2023/05/10/iQQfVZ.png" title="https://i.328888.xyz/2023/05/10/iQQfVZ.png" alt="https://i.328888.xyz/2023/05/10/iQQfVZ.png" role="img" style="max-width: 100% !important; vertical-align: bottom;" loading="lazy" referrerpolicy="no-referrer"></a>)测试(只应解析里面的 a 标签)</span></span><br> </p> <div class="reply_content"> <a href="https://imgloc.com/i/iQQfVZ" target="_blank" rel="noopener"><img src="https://i.328888.xyz/2023/05/10/iQQfVZ.png" title="iQQfVZ.png" alt="iQQfVZ.png" role="img" style="max-width: 100% !important; vertical-align: bottom;" loading="lazy" referrerpolicy="no-referrer"></a><br>感谢分享，已经申请了 </div> <div class="reply_content"> <img src="https://img.bugdog.cn/16cf0" title="测试" alt="测试" role="img" style="max-width: 100% !important; vertical-align: bottom;" loading="lazy" referrerpolicy="no-referrer"> </div> <div class="reply_content" style="white-space: pre-wrap"> 不知道，但我现在想去新西兰种农场。 <a target="_blank" href="https://image.xyzcdn.net/Fg0W7Gk-n2upUJVFZcOEXqbz8hB9.jpg" rel="nofollow noopener noreferrer"><img src="https://image.xyzcdn.net/Fg0W7Gk-n2upUJVFZcOEXqbz8hB9.jpg" title="https://image.xyzcdn.net/Fg0W7Gk-n2upUJVFZcOEXqbz8hB9.jpg" alt="https://image.xyzcdn.net/Fg0W7Gk-n2upUJVFZcOEXqbz8hB9.jpg" role="img" style="max-width: 100% !important; vertical-align: bottom;" loading="lazy" referrerpolicy="no-referrer"></a> <a target="_blank" href="https://image.xyzcdn.net/FvVLyxNE-8CGZUvt3s5vXYybxsaJ.jpg" rel="nofollow noopener noreferrer"><img src="https://image.xyzcdn.net/FvVLyxNE-8CGZUvt3s5vXYybxsaJ.jpg" title="https://image.xyzcdn.net/FvVLyxNE-8CGZUvt3s5vXYybxsaJ.jpg" alt="https://image.xyzcdn.net/FvVLyxNE-8CGZUvt3s5vXYybxsaJ.jpg" role="img" style="max-width: 100% !important; vertical-align: bottom;" loading="lazy" referrerpolicy="no-referrer"></a> <a target="_blank" href="https://image.xyzcdn.net/Fr2BbQqnqgont__isckDRuxq42xQ.jpeg" rel="nofollow noopener noreferrer"><img src="https://image.xyzcdn.net/Fr2BbQqnqgont__isckDRuxq42xQ.jpeg" title="https://image.xyzcdn.net/Fr2BbQqnqgont__isckDRuxq42xQ.jpeg" alt="https://image.xyzcdn.net/Fr2BbQqnqgont__isckDRuxq42xQ.jpeg" role="img" style="max-width: 100% !important; vertical-align: bottom;" loading="lazy" referrerpolicy="no-referrer"></a> <a target="_blank" href="https://image.xyzcdn.net/FrlMxT507OSjGwjw2H1qdkpuHfnK.jpeg" rel="nofollow noopener noreferrer"><img src="https://image.xyzcdn.net/FrlMxT507OSjGwjw2H1qdkpuHfnK.jpeg" title="https://image.xyzcdn.net/FrlMxT507OSjGwjw2H1qdkpuHfnK.jpeg" alt="https://image.xyzcdn.net/FrlMxT507OSjGwjw2H1qdkpuHfnK.jpeg" role="img" style="max-width: 100% !important; vertical-align: bottom;" loading="lazy" referrerpolicy="no-referrer"></a> </div> <p> <a class="upvoter" title="Add upvote"></a> <a class="upvoter" title="Add upvote"></a> <a class="upvoter" title="Add upvote"></a> <a class="upvoter" title="Add upvote"></a> 空 A 标签测试，不应报错。<br> <a href="https://v2hot.pipecraft.net/" target="_blank" rel="noopener"></a>空链接 A 标签测试，不应报错，正常添加 target=_blank<br> <a href="https://image.xyzcdn.net/FrlMxT507OSjGwjw2H1qdkpuHfnK.jpeg" target="_blank" rel="noopener noreferrer"><img src="https://image.xyzcdn.net/FrlMxT507OSjGwjw2H1qdkpuHfnK.jpeg" title="https://image.xyzcdn.net/FrlMxT507OSjGwjw2H1qdkpuHfnK.jpeg" alt="https://image.xyzcdn.net/FrlMxT507OSjGwjw2H1qdkpuHfnK.jpeg" role="img" style="max-width: 100% !important; vertical-align: bottom;" loading="lazy" referrerpolicy="no-referrer"></a>空图片链接 A 标签测试，不应报错，正常显示图片<br> </p> <div class="reply_content"> 测试<img src="https://image.xyzcdn.net/FrlMxT507OSjGwjw2H1qdkpuHfnK.jpeg" title="image" alt="image" role="img" style="max-width: 100% !important; vertical-align: bottom;" loading="lazy" referrerpolicy="no-referrer">Markdown 解析<br> </div> <div class="reply_content"> 测试<img src="https://image.xyzcdn.net/FrlMxT507OSjGwjw2H1qdkpuHfnK.jpeg" title="image" alt="image" role="img" style="max-width: 100% !important; vertical-align: bottom;" loading="lazy" referrerpolicy="no-referrer">Markdown 解析<br> </div> <div class="reply_content"> @<a href="/member/brader">brader</a> <br><br>`<a target="_blank" href="https://image.xyzcdn.net/FrlMxT507OSjGwjw2H1qdkpuHfnK.jpeg" rel="nofollow noopener noreferrer"><img src="https://image.xyzcdn.net/FrlMxT507OSjGwjw2H1qdkpuHfnK.jpeg" title="https://image.xyzcdn.net/FrlMxT507OSjGwjw2H1qdkpuHfnK.jpeg" alt="https://image.xyzcdn.net/FrlMxT507OSjGwjw2H1qdkpuHfnK.jpeg" role="img" style="max-width: 100% !important; vertical-align: bottom;" loading="lazy" referrerpolicy="no-referrer"></a>`<br><br><a target="_blank" href="https://image.xyzcdn.net/FrlMxT507OSjGwjw2H1qdkpuHfnK.jpeg" rel="nofollow noopener noreferrer"><img src="https://image.xyzcdn.net/FrlMxT507OSjGwjw2H1qdkpuHfnK.jpeg" title="https://image.xyzcdn.net/FrlMxT507OSjGwjw2H1qdkpuHfnK.jpeg" alt="https://image.xyzcdn.net/FrlMxT507OSjGwjw2H1qdkpuHfnK.jpeg" role="img" style="max-width: 100% !important; vertical-align: bottom;" loading="lazy" referrerpolicy="no-referrer"></a><br><span> <a href="https://image.xyzcdn.net/Fg0W7Gk-n2upUJVFZcOEXqbz8hB9.jpg" target="_blank" rel="noopener noreferrer"><img src="https://image.xyzcdn.net/Fg0W7Gk-n2upUJVFZcOEXqbz8hB9.jpg" title="https://image.xyzcdn.net/Fg0W7Gk-n2upUJVFZcOEXqbz8hB9.jpg" alt="https://image.xyzcdn.net/Fg0W7Gk-n2upUJVFZcOEXqbz8hB9.jpg" role="img" style="max-width: 100% !important; vertical-align: bottom;" loading="lazy" referrerpolicy="no-referrer"></a></span><br><br>`<img src="https://image.xyzcdn.net/FrlMxT507OSjGwjw2H1qdkpuHfnK.jpeg" title="image" alt="image" role="img" style="max-width: 100% !important; vertical-align: bottom;" loading="lazy" referrerpolicy="no-referrer">`<br><br><img src="https://image.xyzcdn.net/Fr2BbQqnqgont__isckDRuxq42xQ.jpeg" title="image" alt="image" role="img" style="max-width: 100% !important; vertical-align: bottom;" loading="lazy" referrerpolicy="no-referrer"><br><br><br><br><br>回复框好像默认 v2 原生模式吧, 这个需要加 i. 子域名 </div>',
    `<div class="reply_content">我也来试一下<br><img src="https://image.xyzcdn.net/Fr2BbQqnqgont__isckDRuxq42xQ.jpeg" title="皮卡丘" alt="皮卡丘" role="img" style="max-width: 100% !important; vertical-align: bottom;" loading="lazy" referrerpolicy="no-referrer"></div>`,
  ]

  const $$ = (selectors, element) => [
    ...(element || document).querySelectorAll(selectors),
  ]

  function main() {
    const contents = []
    let index = 0
    let failed = false
    for (const element of $$("li")) {
      const content = element.innerHTML.replace(/\s+/gim, " ").trim()
      const expected = expectedList[index++]
      contents.push(content)
      if (expected !== content) {
        failed = true
        console.error(
          `Expected is \n"${expected}" \nbut input is \n"${content}"`
        )
      }
      // console.log(content)
    }

    if (failed) {
      // console.log(JSON.stringify(contents, null, 2))
      console.error("Failed")
    } else {
      console.log("Passed all tests!")
    }
  }

  setTimeout(main, 3000)
})()
